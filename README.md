<h1>Creating a Malware Analysis Lab</h1>

<h2>Description</h2>
This project consists of creating a secure and isolated environment for malware analysis by setting up a Windows 10 virtual machine using VirtualBox and subsequently loading it with VMware. This lab facilitates both passive and static analysis of malware, to provide a comprehensive understanding of malware behavior and characteristics.
<br />


<h2>Languages and Utilities Used</h2>

- <b>Virtual Box</b> 
- <b>VMware</b>

<h2>Environments Used </h2>

- <b>Windows 10</b>

<h2>Program walk-through:</h2>

<p align="center">
First we will need to set up our virtual machine which can be done using an ISO image from https://www.microsoft.com/en-ca/software-download/windows10ISO loaded into a new virtual machine in VirtualBox: 
<br/>
<br/>
<img src="https://i.imgur.com/c5JhbUc.png" height="80%" width="80%" alt="Create VM with ISO"/>
<br/>
<img src="https://i.imgur.com/gNjeqDn.png" height="80%" width="80%" alt="Finish VM set up"/>
<br/>
<br/>
Once we complete the standard Windows 10 setup we need to configure the VM to remove the standard protections that Windows provides us. This will include disabling Windows update and Windows Defender. We want to reduce these protections so that our malware is not inhibited when we try to analyze it on the VM.

To do this we just need to navigate to the **Run dialog** (Win + R) and input "services.msc".<br/>
<br/>
<img src="https://i.imgur.com/sT6BJZ4.png" height="80%" width="80%" alt="Open the Run dialog"/>
<br/>
<img src="https://i.imgur.com/34CFMMa.png" height="80%" width="80%" alt="Input services.msc into Run dialog"/>
<br/>
<br/>
Once we've done this we navigate to **Windows Update** in the list of services and stop the service. We also want to change the startup type to *Disabled* so Windows Update does not re-launch on Startup.<br/>
<br/>
<img src="https://i.imgur.com/jOu99ro.png" height="80%" width="80%" alt="Disable Windows Update"/>
<br/>
<br/>
After this we want to navigate to **Windows Security > Virus and threat protection settings**<br/>
<br/>
<img src="https://i.imgur.com/pgGmSLq.png" height="80%" width="80%" alt="Navigate to Windows Security"/>
<br/>
<br/>
Then turn off *Real-time protection, Cloud-delivered protection, Automatic sample submission* and *Tamper protection*.<br/>
<br/>
<img src="https://i.imgur.com/Kz9wuaN.png" height="80%" width="80%" alt="Disable virus and threat protection services"/>
<br/>
<br/>
After this we will open the Run dialog again and input "gpedit.msc" to access the Local Group Policy Editior.<br/>
<br/>
<img src="https://i.imgur.com/ypktImT.png" height="80%" width="80%" alt="Open run dialog and input gpedit.msc"/>
<br/>
<br/>
From here, on the left, we will navigate to **Local Computer Policy / Computer Configuration / Administrative Templates / Windows Components / Microsoft Defender Antivirus**<br/>
<br/>
<img src="https://i.imgur.com/vEDA6Wn.png" height="80%" width="80%" alt="Select Turn off real-time protection"/>
<br/>
<br/>
Then select **Real-time Protection** on the right. Within this folder we want to double click **Turn off real-time protection**, and then select *Enabled* and click *Ok*<br/>
<br/>
<img src="https://i.imgur.com/Ec3RoQL.png" height="80%" width="80%" alt="Disable real-time protection"/>
<br/>

Next we want to disable Windows Defender Antivirus. To do this we select the filepath **Local Computer Policy / Computer Configuration / Administrative Templates / Windows Components / Microsoft Defender Antivirus** on the left and then select *Turn off Microsoft Defender Antivirus*. Again we want to select *Enabled* and then *Ok*  <br/>
<br/>
<img src="https://i.imgur.com/QVFh9zu.png" height="80%" width="80%" alt="Disable Microsoft Defender Antivirus"/>
<br />
<br />
At this point it's a good idea to restart your system as we have made a lot of changes to some key settings. Once you have done so we can move on to the next step.
<br/>
<br/>
Next we want to change our Folder Options in File Explorer to display hidden files and extensions. The reason for this is because commonly malware will be NAMED with a benign file extension, but actually be a malicious file format. For example, a file may be NAMED "financial_reports.doc" to make it seem like a document file, whereas if we look at the actual file properties it can turn out to be an executable file (.exe) which could do harm to a computer.
<br/>
<br/>
To change this we open *File Explorer* and in the menu bar we click *View > options > Change folder and search options* from here we will select *View* again in the menu bar of the dialog box which has just opened. Under the *Advanced settings* pane we want to scroll to *Hidden files and folders* and select *Show hidden files, folders and drives*. Beneath this look for the option to *Hide extensions for known file types* and de-select this. Click *Ok*
<br/>
<br/>
<img src="https://i.imgur.com/ftRiVyY.png" height="80%" width="80%" alt="Show hidden files and folders"/>
<br />
<br />
Now we can go ahead and install VMware. To do this we just want to open our internet browser and navigate to https://github.com/mandiant/flare-vm, scroll down and follow the installation instructions. 
<br />
<br />
<img src="https://i.imgur.com/IJQPqHL.png" height="80%" width="80%" alt="Navigate to flare-vm on GitHub"/>
<br />
<br />
This will have us run powershell and execute an installation script.
<br />
<br />
<img src="https://i.imgur.com/xh0zfRm.png" height="80%" width="80%" alt="Install VMware"/>
<br />
<br />
This will install VMware onto our virtual machine, including the tools we will need for our malware analysis
<br/>
<br/>
<img src="https://i.imgur.com/Oy7XkvJ.png" height="80%" width="80%" alt="VMware installation complete"/>
<br/>
<br/>
This is another good opportunity to restart our virtual machine and make a change within the VirtualBox settings to protect our host system. We needed an internet connection for our Windows installation and setup but now we want to prevent any malware we execute from reaching an internet connection or our host system, so to do this we can go to the virtual machine's settings in Virtual Box, select the *Network* option on the left and under the active adapter (in this case Adapter 1) we can select *Host-only Adapter* in place of *NAT*. Click *Ok*.
<br/>
<br/>
<img src="https://i.imgur.com/tCVAg4g.png" height="80%" width="80%" alt="Change VM network settings in VirtualBox"/>
<br/>
<br/>
Using a Host-Only Adapter ensures that any malicious activities initiated by the malware remain contained within the VM and do not affect the host system or other devices on the network.
<br/>
<br/>
Lastly, we want to take a snapshot of this system so that we can revert back to it each time we want to undo any damage created by malware or to have a fresh system to study a new sample within.
<br/>
<br/>
To do this we simply select *Machine* from the _x_VirtualBox window_x_ menu bar, then select *Take Snapshot*. Give it a name of your choosing and then select *Ok*
<br/>
<br/>
<img src="https://i.imgur.com/NGc66zo.png" height="80%" width="80%" alt="Take VM snapshot"/>
<br/>
<br/>
Our malware analysis lab is now ready for use!
<br/>
<br/>

<!--
 ```diff
- text in red
+ text in green
! text in orange
# text in gray
@@ text in purple (and bold)@@
```
--!>
